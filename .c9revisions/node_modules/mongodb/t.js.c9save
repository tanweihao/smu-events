{"ts":1382093074870,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var mongodb = require('./lib/mongodb');                                               \n\nvar mongoserver = new mongodb.Server('localhost', 27017, {});                   \nvar db_conn = new mongodb.Db('test1', mongoserver, { w : 1 });                  \n\ndb_conn.on('open', function () {                                                \n  console.log(\"this is an open event\");                                         \n});                                                                             \n\ndb_conn.on('close', function () {                                               \n  console.log(\"this is a close event\");                                         \n});                                                                             \n\ndb_conn.on('reconnect', function () {\n  console.log(\"this is a reconnect event\");                                         \n});                                                                             \n\ndb_conn.open(function (err) {                                                   \n  if (err) throw err;                                                           \n\n  var col = db_conn.collection('test');                                         \n\n  var count = 0;                                                                \n  // Run a simple 'find' query every second                                     \n  setInterval(function() {                                                      \n    col.findOne(function(err, item) {  \n      if (err) {                                                                \n        return console.log(\"mongodb query not ok %d\", count)                    \n      }                                                                         \n      console.log(\"mongodb query ok %d\", count);                                \n      count++;                                                                  \n    })                                                                          \n    if (count == 40) {                                                          \n      db_conn.close();                                                          \n    }                                                                           \n  }, 1000)                                                                      \n  console.log('hi');                                                            \n});\n\n// var MongoClient = require('./lib/mongodb').MongoClient\n// \t, Server = require('./lib/mongodb').Server\n//   , ReplSet = require('./lib/mongodb').ReplSet\n// \t, Db = require('./lib/mongodb').Db;\n// var format = require('util').format;\n\n// var host = process.env['MONGO_NODE_DRIVER_HOST'] || 'localhost'; \n// var port = process.env['MONGO_NODE_DRIVER_PORT'] || 27017;\n// var url = format(\"mongodb://%s:%s,%s:%s,%s:%s/node-mongo-examples\"\n//         , host, port, host, 27018, host, 27019);\n// var url = \"mongodb://localhost:27017/node-mongo-examples\"\n// // console.dir(url)\n\n// // MongoClient.connect(url, function(err, db) {\n// // new Db(\"node-mongo-examples\", new Server(\"localhost\", 27017), {w:1}).open(function(err, db) {\n// var replSet = new ReplSet([new Server(\"localhost\", 31000)\n//   , new Server(\"localhost\", 31001)\n//   , new Server(\"localhost\", 31002)])\n// new Db(\"node-mongo-examples\", replSet, {safe:true}).open(function(err, db) {\n//   if(err) throw err;\n//   console.log(\"=========================== 0\")\n//   db.close();\n// });\n\n//   // console.log(\"------------------------- 0\")\n\n//   // db.on('error', function(err, db) {\n//   //  console.log(\"---------------------- GOT ERROR\")\n//   //  console.dir(err)\n//   //   db.close(function() {\n//   //    console.log(\"----------------- error\")\n//   //     process.exit(1);\n//   //   })\n//   // });\n//    //  // throw new Error(\"3\")\n\n//   // console.log('connected');\n\n//   // db.collection('t').findOne(function(err, result) {\n//   //  console.log(\"33333\")\n//    //  throw new Error(\"3\")\n//   // })\n    \n//   // thisMethodDoesNotExists('foo', 'bar', 123);\n\n// process.on(\"uncaughtException\", function(err) {\n// \tconsole.log(\"######################\")\n// })\n\n// // var now;\n// // var obj, i;\n// // var count = 10000000;\n// // var key = 'key';\n \n// // obj = {};\n// // now = Date.now();\n// // for (i = 0; i < count; i++) {\n// // obj[key] = 1;\n// // obj[key] = null;\n// // }\n// // console.log('null assignment(`obj[key] = null`):\\n %d ms', Date.now() - now);\n \n// // obj = {};\n// // now = Date.now();\n// // for (i = 0; i < count; i++) {\n// // obj[key] = 1;\n// // delete obj[key];\n// // }\n// // console.log('deleting property(`delete obj[key]`):\\n %d ms', Date.now() - now);\n\n// // // var mongodb = require('./lib/mongodb');\n\n// // // // var url = 'mongodb://user:pass@host1,host2,host3/db';\n// // // var url = 'mongodb://127.0.0.1:31000,192.168.2.173:31001,127.0.0.1:31002/test';\n// // // var options = {db: {safe: true}, server: {auto_reconnect: true}};\n\n// // // mongodb.connect(url, options, function (err, db) {\n// // //   if (err) {\n// // //     console.log(err);\n// // //     process.exit(1);\n// // //   }\n\n// // //   db.collection('test', function (err, c) {\n// // //     if (err) {\n// // //       console.log(err);\n// // //       process.exit(2);\n// // //     }\n\n// // //     var successCount = 0;\n// // //     var errCount = 0;\n// // //     var lastErr = null;\n// // //     setInterval(function () {\n// // //       c.find({}).limit(100).toArray(function (err, results) {\n// // //         if (err) {\n// // //           lastErr = err;\n// // //           errCount++;\n// // //         } else {\n// // //           successCount++;\n// // //         }\n// // //       });\n// // //     }, 100);\n\n// // //     setInterval(function () {\n// // //       console.log(\"STATUS\", successCount, errCount);\n// // //     }, 1000);\n\n// // //   });\n// // // });"]],"start1":0,"start2":0,"length1":0,"length2":5769}]],"length":5769}
