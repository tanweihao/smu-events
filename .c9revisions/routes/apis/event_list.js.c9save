{"ts":1382008688706,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":true,"ts":1382008703212,"patch":[[{"diffs":[[1,"module.exports = function (args) {\n    var app = args.app,\n        url = args.url,\n        db = args.db,\n        ensureAuthenticated = args.ensureAuthenticated;\n    app.get('/api/country_check', ensureAuthenticated, function (req, res) {\n        var _get = url.parse(req.url, true).query,\n            customer = req.user.customer;\n\n        // Parameters passed in URL\n        var country = (_get.country) ? _get.country : '';\n\n        var data = {};\n\n        var countries = db.collection(\"countries_lookup\");\n        regex_search(countries, country);\n\n        function regex_search(search_collection, name) {\n            if (name !== \"\") {\n                var regex = new RegExp(\"^\" + name + \".*\", \"i\");\n                console.log(regex);\n                var match = {\n                    \"Name\": {\n                        $regex: regex\n                    }\n                };\n                search_collection.aggregate([{\n                    $match: match\n                }, {\n                    $group: {\n                        _id: {\n                            name: \"$Name\",\n                            code: \"$iso_a2\"\n                        }\n                    }\n                }], function (err, results) {\n                    if (!err) {\n                        var data = [];\n                        var status = false;\n                        var code = \"\";\n                        results.forEach(function (result) {\n                            if (result._id.name === name) {\n                                code = result._id.code;\n                                res.json({\n                                    status: true,\n                                    result: \"\",\n                                    code: code\n                                });\n                                status = true;\n                            } else {\n                                data.push({\n                                    name: result._id.name,\n                                    code: result._id.code\n                                });\n                            }\n                        });\n                        if (data.length > 10) {\n                            while (data.length > 10) {\n                                data.pop();\n                                if (data.length === 10) {\n                                    res.json({\n                                        status: status,\n                                        result: data\n                                    });\n                                }\n                            }\n                        }\n                        else {\n                            res.json({\n                                status: status,\n                                result: (status === true) ? \"\" : data,\n                                code: code\n                            });\n                        }\n                    }\n                    else {\n                        res.json(err);\n                    }\n                });\n            }\n            else {\n                res.json({\n                    status: true,\n                    result: []\n                });\n            }\n        }\n    });\n}"]],"start1":0,"start2":0,"length1":0,"length2":3206}]],"length":3206,"saved":false}
{"contributors":[],"silentsave":true,"ts":1382008841897,"patch":[[{"diffs":[[0,".url"],[-1,",\n        db = args.db,\n        ensureAuthenticated = args.ensureAuthenticated"],[0,";\n  "]],"start1":77,"start2":77,"length1":86,"length2":8},{"diffs":[[0,"ck',"],[-1," ensureAuthenticated,"],[0," fun"]],"start1":112,"start2":112,"length1":29,"length2":8}]],"length":3107,"saved":false}
{"ts":1382008863024,"patch":[[{"diffs":[[0,"api/"],[-1,"country_check"],[1,"event_list"],[0,"', f"]],"start1":97,"start2":97,"length1":21,"length2":18}]],"length":3104,"saved":false}
{"ts":1382008948829,"patch":[[{"diffs":[[0,"    "],[-1,"var data = {};\n\n        var countries = db.collection(\"countries_lookup\");\n        regex_search(countries, country);\n\n        function regex_search(search_collection, name) {\n            if (name !== \"\") {\n                var regex = new RegExp(\"^\" + name + \".*\", \"i\");\n                console.log(regex);\n                var match = {\n                    \"Name\": {\n                        $regex: regex\n                    }\n                };\n                search_collection.aggregate([{\n                    $match: match\n                }, {\n                    $group: {\n                        _id: {\n                            name: \"$Name\",\n                            code: \"$iso_a2\"\n                        }\n                    }\n                }], function (err, results) {\n                    if (!err) {\n                        var data = [];\n                        var status = false;\n                        var code = \"\";\n                        results.forEach(function (result) {\n                            if (result._id.name === name) {\n                                code = result._id.code;\n                                res.json({\n                                    status: true,\n                                    result: \"\",\n                                    code: code\n                                });\n                                status = true;\n                            } else {\n                                data.push({\n                                    name: result._id.name,\n                                    code: result._id.code\n                                });\n                            }\n                        });\n                        if (data.length > 10) {\n                            while (data.length > 10) {\n                                data.pop();\n                                if (data.length === 10) {\n                                    res.json({\n                                        status: status,\n                                        result: data\n                                    });\n                                }\n                            }\n                        }\n                        else {\n                            res.json({\n                                status: status,\n                                result: (status === true) ? \"\" : data,\n                                code: code\n                            });\n                        }\n                    }\n                    else {\n                        res.json(err);\n                    }\n                });\n            }\n            else {\n                res.json({\n                    status: true,\n                    result: []\n                });\n            }\n        }"],[1,"res.json({\n                                        status: status,\n                                        result: data\n                                    });"],[0,"\n   "]],"start1":329,"start2":329,"length1":2769,"length2":167}]],"length":502,"saved":false}
{"ts":1382008952352,"patch":[[{"diffs":[[0,"    "],[-1,"                            status: status,\n                                        result: data\n                            "],[1,"status: status,\n            result: data\n"],[0,"    "]],"start1":352,"start2":352,"length1":133,"length2":49}]],"length":418,"saved":false}
{"ts":1382008958109,"patch":[[{"diffs":[[0,"        "],[-1,"statu"],[1,"event"],[0,"s: statu"]],"start1":348,"start2":348,"length1":21,"length2":21}]],"length":418,"saved":false}
{"ts":1382008963208,"patch":[[{"diffs":[[0,"ts: "],[-1,"status"],[1,"[]"],[0,",\n  "]],"start1":360,"start2":360,"length1":14,"length2":10}]],"length":414,"saved":false}
{"ts":1382008965595,"patch":[[{"diffs":[[0,"vents: ["],[1,"\"a\""],[0,"],\n     "]],"start1":357,"start2":357,"length1":16,"length2":19}]],"length":417,"saved":false}
{"ts":1382008968718,"patch":[[{"diffs":[[0,"ts: [\"a\""],[1,",\"b\""],[0,"],\n     "]],"start1":360,"start2":360,"length1":16,"length2":20}]],"length":421,"saved":false}
{"ts":1382008973023,"patch":[[{"diffs":[[0,"\"b\"]"],[-1,",\n            result: data"],[0,"\n   "]],"start1":369,"start2":369,"length1":34,"length2":8}]],"length":395,"saved":false}
{"ts":1382008979973,"patch":[[{"diffs":[[0,"uery"],[-1,",\n            customer = req.user.customer"],[0,";\n\n "]],"start1":181,"start2":181,"length1":50,"length2":8}]],"length":353,"saved":false}
{"ts":1382008983458,"patch":[[{"diffs":[[0," URL\n       "],[1," //"],[0," var country"]],"start1":219,"start2":219,"length1":24,"length2":27}]],"length":356,"saved":false}
